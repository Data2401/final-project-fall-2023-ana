---
title: "Housing Data"
author: "Nadia and Ana"
date: "2023-11-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, echo = TRUE, message = FALSE)
```
## Where is this Data coming from ?
 For our project, we chose Redfin as our primary data source due to its reliability and up-to-date information. Redfin, being a real estate brokerage provides us with direct access to data from local multiple listing services. The real-time update feature allows us to explore genuine and timely values, enabling a thorough analysis of the ever-evolving real estate landscape. By utilizing Redfin's comprehensive dataset on county-level housing market trends, we hope to offer valuable insights and contribute to a more informed understanding of the broader market conditions.
</center>

![](Redfin copy.jpg){width=50%}
</center>

Source:
https://www.redfin.com/news/data-center/

## Questions
- How do the median sale prices of different property types compare over the years in Texas counties?
- How do these trends for individual property types appear?
- Which property type was purchased the most throughout the years?
- What did the median sale prices look like in 2020 compared to 2023?
- How does the median listing price compare to the sold price in Harris County?
- In Harris County, which season is the most popular for buying/selling?
- In 2023, which counties are the most expensive to purchase a home in?
- In 2023, which counties are the least expensive to purchase a home in?


## Libraries Used
```{r}
library(kableExtra) # Useful to create a nicely formatted table.
library(viridis) # Provides color palettes suitable for data visualization.
library(tidyverse)  # Useful for data manipulation tasks and visualization.
library(data.table) # Useful to transform the tsv file to a csv file making it easier to read and to use for data manipulation.
library(urbnmapr) # Useful for creating geographic visualizations, as seen in mapping Texas counties.
library(viridisLite) # A lightweight version of viridis for color palettes.
# Read TSV file using fread() from data.table
# tskv_file <- "county_market_tracker.tsv000"
# data <- fread(tskv_file)
# # CSV file
# csv_file <- "output_file.csv"
# fwrite(data, file = csv_file)
# housingdata2 <- read.csv(csv_file)
texas_data <- read_csv("texas_data.csv")
```

## Filtering Data Just to State of Texas
The original TSV file contained all the counties across the United States, making the data too large. To address this, we decided to focus solely on the state of Texas and the variables we chose to work with.
```{r}
# #texas_data <- housingdata2 %>%
#   select(period_begin, period_end, region, state, property_type, homes_sold, 
#          median_sale_price, median_ppsf, median_list_price, new_listings, 
#          inventory) %>%                
#   filter(state == "Texas") %>%
#   filter(!is.na(homes_sold) & !is.na(median_sale_price) & !is.na(median_ppsf))

```

```{r, echo=FALSE}
#The dates were classified as a character so right here we're just changing it to numeric
texas_data <- texas_data %>% 
  mutate(
    period_begin = as.Date(period_begin),
    period_end = as.Date(period_end),
    month_begin = month(period_begin),
    day_begin = day(period_begin),
    year_begin = year(period_begin),
    month_end = month(period_end),
    day_end = day(period_end),
    year_end = year(period_end)
  )

texas_counties <- texas_data %>%
  filter(str_detect(region, ", TX"))
texas_counties$region <- gsub(", TX", "", texas_counties$region)


```
## Property types through the years
This graph visually tracks Texas real estate trends from 2012 to present, displaying average median sale prices for different property types. Points on the lines highlight specific data, and color-coded distinctions enhance clarity.
```{r, echo=FALSE}
texas_data %>%
  group_by(property_type, year_end) %>%
  summarise(avg_median_price = mean(median_sale_price, na.rm = TRUE)) %>%
  ggplot(aes(x = year_end, y = avg_median_price, color = property_type)) +
  geom_line() +
  geom_point() +
  labs(title = "Average Median Sale Price Trends by Property Type",
       x = "Year",
       y = "Average Median Sale Price",
       color = "Property Type") +
  theme_minimal() +
  scale_color_brewer(palette = "Set1")
```

## Extra Graphs 
```{r, echo=FALSE}
average_prices <- texas_data %>%
  group_by(property_type, year_end) %>%
  summarise(avg_median_price = mean(median_sale_price, na.rm = TRUE))

ggplot(average_prices, aes(x = year_end, y = avg_median_price)) +
  geom_line() +
  labs(title = "Average Median Sale Price Trend for Texas Counties",
       x = "Year",
       y = "Average Median Sale Price") +
  facet_wrap(~ property_type, scales = "free_y") +
  theme_minimal()

```

## Distribution of property types sold through the years
This chart shows how the kinds of homes sold in Texas have changed over time. Each bar is a different type of property. What's interesting is that, overall, it has stayed pretty consistent through the years.
```{r, echo=FALSE}
ggplot(texas_data, aes(x = property_type, fill = property_type)) +  
  geom_bar() +
  labs(title = "Property Types Sold Throughout the years",
       x = "Property Type",
       y = "Count") + 
  coord_flip() + facet_wrap(~ year_end)
```

```{r, echo=FALSE}
newtexas <- texas_counties %>% 
  select(region, state, median_sale_price, year_end) %>%                
  filter(year_end == 2023) %>% 
  group_by(region, state) %>% 
  summarise(average_county = mean(median_sale_price, na.rm = TRUE))

newtexas2020 <- texas_counties %>% 
  select(region, state, median_sale_price, year_end) %>%                
  filter(year_end == 2020) %>% 
  group_by(region, state) %>% 
  summarise(average_county = mean(median_sale_price, na.rm = TRUE))

texas_data_2023 <- texas_data %>%
  filter(year_end == 2023)

# Filter data for the year 2020
texas_data_2020 <- texas_data %>%
  filter(year_end == 2020)
```

## What was the median sale price like across Texas counties in 2020?
Pay close attention to the number of counties highlighted in orange, as it will be relevant to the next slide
```{r, echo=FALSE}
#devtools::install_github("UrbanInstitute/urbnmapr")

newtexas_map2 <- left_join(newtexas2020, counties, by = c("region" = "county_name")) %>%
  filter(state_name == "Texas") 

price_categories <- c("< $100,000", "$100,000 - $200,000", "$200,000 - $300,000", "> $300,000")
price_colors <- c("#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3")  # Choose your own colors

# color categories and corresponding price ranges
price_categories2 <- c("< $100,000", "$100,000 - $200,000", "$200,000 - $300,000", "> $300,000")
price_colors2 <- c("#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3")  

# Create a factor variable for fill with the defined categories
newtexas_map2$price_category <- cut(newtexas_map2$average_county,
                                   breaks = c(-Inf, 100000, 200000, 300000, Inf),
                                   labels = price_categories,
                                   include.lowest = TRUE)

# Plot using ggplot 
ggplot(data = newtexas_map2, aes(long, lat, group = group, fill = price_category)) +
  geom_polygon(color = "#ffffff", size = 0.25) +
  scale_fill_manual(values = setNames(price_colors, price_categories)) +
  coord_map(projection = "albers", lat0 = 27, lat1 = 35, xlim = c(-106, -93), ylim = c(25, 37)) +
  theme(legend.title = element_text(),
        legend.key.width = unit(0.5, "in")) +
  labs(fill = "Average Median Sale Price in Texas Counties 2020")

```

## What was the median sale price like across Texas counties in 2023?
Yikes! The counties appear to be more pink and purple now.
```{r, echo=FALSE}

newtexas_map <- left_join(newtexas, counties, by = c("region" = "county_name")) %>%
  filter(state_name == "Texas") 

# Define color categories and corresponding price ranges


newtexas_map$price_category <- cut(newtexas_map$average_county,
                                   breaks = c(-Inf, 100000, 200000, 300000, Inf),
                                   labels = price_categories,
                                   include.lowest = TRUE)

# Plot using ggplot with discrete color boxes
ggplot(data = newtexas_map, aes(long, lat, group = group, fill = price_category)) +
  geom_polygon(color = "#ffffff", size = 0.25) +
  scale_fill_manual(values = setNames(price_colors, price_categories)) +
  coord_map(projection = "albers", lat0 = 27, lat1 = 35, xlim = c(-106, -93), ylim = c(25, 37)) +
  theme(legend.title = element_text(),
        legend.key.width = unit(0.5, "in")) +
  labs(fill = "Average Median Sale Price in Texas Counties 2023")

```

## Which counties are the most expensive to purchase a home in 2023?
```{r, echo=FALSE}
avghome <- texas_data_2023 %>%
  group_by(region) %>%
  mutate(avg_median_sale_price = mean(median_sale_price, na.rm = TRUE)) %>%
  select(region, avg_median_sale_price) %>%
  distinct()  %>%   arrange(desc(avg_median_sale_price))

head(avghome, 5)

top5_avghome <- head(avghome, 5)

ggplot(top5_avghome, aes(x = fct_reorder(region, avg_median_sale_price), y = avg_median_sale_price)) +
geom_bar(stat = "identity", fill = "pink") +
labs(title = "Top 5 Regions by Average Median Sale Price",
x = "Region",
y = "Average Median Sale Price") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 10, hjust = 1))

```


## Which counties are the least expensive to purchase a home in during 2023?
```{r, echo=FALSE}
avghome2 <- texas_data_2023 %>%
  group_by(region) %>%
  mutate(avg_median_sale_price = mean(median_sale_price, na.rm = TRUE)) %>%
  select(region, avg_median_sale_price) %>%
  distinct()  %>%   arrange(avg_median_sale_price)


cheap5 <- head(avghome2,5)
cheap5

ggplot(cheap5, aes(x = fct_reorder(region, avg_median_sale_price), y = avg_median_sale_price)) +
geom_bar(stat = "identity", fill = "pink") +
labs(title = "Top 5 Regions by Average Median Sale Price",
x = "Region",
y = "Average Median Sale Price") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 10, hjust = 1))

```

## Let's take a thorough look at all the counties in Texas and how their listed and sold prices compare in 2023
If you'd like us to look at a county you are interested in, go ahead and raise your hand, and we'll do our best to find it
```{r, echo=FALSE}
scrollbox <- texas_data_2023 %>%
  group_by(region) %>%
  summarize(
    median_sale_price = mean(median_sale_price, na.rm = TRUE),
    median_list_price = mean(median_list_price, na.rm = TRUE)
  ) %>%
  arrange(desc(median_sale_price)) %>%
  kbl() %>%
  kable_paper() %>%
  scroll_box(height = "300px")

scrollbox
```

## Now let's take a closer look at Harris County!
```{r}
harris_county <- texas_data %>% filter(region == "Harris County, TX") %>% arrange(period_begin) 
```

## How does the median price listing compare to the price sold in Harris County?
```{r, echo=FALSE}
harris_county_monthly <- harris_county %>%
  group_by(year_begin, month_begin) %>%
  summarise(
    median_list_price = mean(median_list_price),
    median_sale_price = mean(median_sale_price)
  )


ggplot(harris_county_monthly, aes(x = year_begin + month_begin/12)) +
  geom_line(aes(y = median_list_price, color = "Median Listing Price")) +
  geom_line(aes(y = median_sale_price, color = "Median Sales Price")) +
  labs(title = "Comparison of Median Listing and Median Sales Prices in Harris County, TX, Over the Years",
       x = "Year",
       y = "Price",
       color = "Legend") +
  scale_color_manual(values = c("Median Listing Price" = "blue", "Median Sales Price" = "red")) +
  theme_minimal()
```

## Which season is the most popular for buying and selling homes in Harris County?
The bars in the graph represent the total number of homes sold. It's evident that summer and spring are the most popular times for selling homes. However, there's another observation worth noting. Can you see it?
```{r, echo=FALSE}
texas_data <- texas_data %>%
  mutate(
    season_begin = case_when(
      month_begin %in% c(3, 4, 5) ~ "Spring",
      month_begin %in% c(6, 7, 8) ~ "Summer",
      month_begin %in% c(9, 10, 11) ~ "Fall",
      month_begin %in% c(12, 1, 2) ~ "Winter",
      TRUE ~ NA_character_
    ),
    season_end = case_when(
      month_end %in% c(3, 4, 5) ~ "Spring",
      month_end %in% c(6, 7, 8) ~ "Summer",
      month_end %in% c(9, 10, 11) ~ "Fall",
      month_end %in% c(12, 1, 2) ~ "Winter",
      TRUE ~ NA_character_
    )
  )

harris_county <- texas_data %>% filter(region == "Harris County, TX") %>% arrange(period_begin) 


ggplot(harris_county, aes(x = factor(year_begin), y = homes_sold, fill = season_begin)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Homes Sold Over the Years in Harris County, TX, by Season",
       x = "Year",
       y = "Homes Sold") +
  scale_fill_manual(values = c("Spring" = "#7cc969", "Summer" = "#f089b8", "Fall" = "#e4832f", "Winter" = "#1da4b4")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Correct! In the year 2020, winter was the only season that secured the second-highest number of homes sold
![](Very-Good.png){width=30%}

## Summary

In today's presentation, we started an exploratory analysis using Redfin's detailed data on county-level housing market trends. Our goal was simple- to shed light on regions that are more affordable and those that are on the pricier side for potential movers. By examining how these trends have evolved over the years, we aimed to provide evidence and insights into the changing landscape of the housing market. Our hope is that this exploration has contributed to a clearer understanding of the broader market conditions, empowering everyone with valuable information for making informed decisions. Thank you! 





